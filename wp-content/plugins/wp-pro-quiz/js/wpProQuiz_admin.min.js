jQuery(document).ready(function(a){a.fn.wpProQuiz_preview=function(){var b={openPreview:function(b){window.open(a(b).attr("href"),"wpProQuizPreview","width=900,height=900")}};a(".wpProQuiz_prview").click(function(a){b.openPreview(this);a.preventDefault()})};a.fn.wpProQuiz_quizOverall=function(){var b={changeExport:function(b){$input=a(b);$export=a(".wpProQuiz_exportList");$ul=$export.find("ul").first();$export.find("li").remove();a('input[name="exportItems"]').each(function(){$this=a(this);if(this.checked){var b=
$this.parent().parent().find(".wpProQuiz_quizName a:eq(0)").text();a("<li>"+b+"</li>").appendTo($ul)}})},startExport:function(){$ele=a('input[name="exportItems"]:checked');if(1>$ele.length)return alert(wpProQuizLocalize.no_selected_quiz),!1;$hidden=a("#exportHidden");$hidden.html("");a('input[name="exportItems"]').each(function(){$this=a(this);this.checked&&a('<input type="hidden" value="'+this.value+'" name="exportIds[]">').appendTo($hidden)});return!0}};a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?
(a.preventDefault(),!1):!0});a(".wpProQuiz_import").click(function(b){b.preventDefault();a(".wpProQuiz_importList").toggle("fast");a(".wpProQuiz_exportList").hide();a(".wpProQuiz_exportCheck").hide()});a(".wpProQuiz_export").click(function(b){b.preventDefault();a(".wpProQuiz_exportList").toggle("fast");a(".wpProQuiz_exportCheck").toggle("fast");a(".wpProQuiz_importList").hide()});a('input[name="exportItems"]').change(function(){b.changeExport(this)});a('input[name="exportItemsAll"]').change(function(){var b=
a('input[name="exportItems"]');this.checked?b.attr("checked",!0):b.attr("checked",!1);b.change()});a("#exportStart").click(function(a){b.startExport()||a.preventDefault()})};a.fn.wpProQuiz_questionOverall=function(){var b={saveSort:function(){var g={action:"wp_pro_quiz_update_sort",sort:b.parseSortArray()},d=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=save_sort";a.post(d,g,function(){a("#sortMsg").show(400).delay(1E3).hide(400)})},parseSortArray:function(){var b=
[];a("tbody tr").each(function(){b.push(this.id.replace("wpProQuiz_questionId_",""))});return b},sortUpdate:function(){a(".wpProQuiz_questionOverall tbody").children().each(function(){$t=a(this).children().first().text(a(this).index()+1)})},loadQuestionCopy:function(){var b=a("#questionCopySelect"),d=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_question";b.hide();b.empty();a("#loadDataImg").show();a.post(d,{action:"wp_pro_quiz_load_question",
excludeId:1},function(d){a.each(d,function(d,c){var e=a(document.createElement("optgroup"));e.attr("label",c.name);a.each(c.question,function(b,c){a(document.createElement("option")).val(c.id).text(c.name).appendTo(e)});b.append(e)});a("#loadDataImg").hide();b.show()},"json")}};a(".wp-list-table tbody").sortable({handle:".wpProQuiz_move",update:b.sortUpdate});a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?(a.preventDefault(),!1):!0});a("#wpProQuiz_saveSort").click(function(a){a.preventDefault();
b.saveSort()});a("#wpProQuiz_questionCopy").click(function(g){var d=a(".wpProQuiz_questionCopy");d.is(":visible")?d.hide():(d.show(),b.loadQuestionCopy());g.preventDefault()})};a.fn.wpProQuiz_quizEdit=function(){var b={addResult:function(){a("#resultList").children().each(function(){if("none"==a(this).css("display")){var b=a(this),e=b.find('textarea[name="resultTextGrade[text][]"]'),f=e.attr("id"),c=!0;b.find('input[name="resultTextGrade[prozent][]"]').val("0");b.find('input[name="resultTextGrade[activ][]"]').val("1").keyup();
void 0!=tinymce.editors[f]&&!tinymce.editors[f].isHidden()&&(c=!1);void 0!=switchEditors&&!c&&(switchEditors.go(f,"toggle"),switchEditors.go(f,"toggle"));void 0!=tinymce.editors[f]?tinymce.editors[f].setContent(""):e.val("");void 0!=tinymce.editors[f]&&!c&&tinyMCE.execCommand("mceRemoveControl",!1,f);b.parent().children(":visible").last().after(b);void 0!=tinymce.editors[f]&&!c&&tinyMCE.execCommand("mceAddControl",!1,f);a(this).show();void 0!=switchEditors&&!c&&switchEditors.go(f,"toggle");return!1}})},
deleteResult:function(b){a(b).parent().parent().hide();a(b).siblings('input[name="resultTextGrade[activ][]"]').val("0")},changeResult:function(d){d=a(d);if(b.validResultInput(d.val()))return d.siblings(".resultProzent").text(d.val()),d.removeAttr("style"),!0;d.css("background-color","#FF9696");return!1},validResultInput:function(a){if(g(a))return!1;a=a.replace(/\,/,".");return!isNaN(a)&&100>=Number(a)&&0<=Number(a)?null!=a.match(/\./)?3>a.split(".")[1].length:!0:!1},validInput:function(){if(g(a("#wpProQuiz_title").val()))return alert(wpProQuizLocalize.no_title_msg),
!1;var d="",d=void 0!=tinymce.editors.text&&!tinymce.editors.text.isHidden()?tinymce.editors.text.getContent():a('textarea[name="text"]').val();if(g(d))return alert(wpProQuizLocalize.no_quiz_start_msg),!1;if(a("#wpProQuiz_resultGradeEnabled:checked").length){var e=!0;a("#resultList").children().each(function(){if(a(this).is(":visible")&&!b.validResultInput(a(this).find('input[name="resultTextGrade[prozent][]"]').val()))return e=!1});if(!e)return alert(wpProQuizLocalize.fail_grade_result),!1}return!0},
resetLock:function(){var b=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php"),b=b.replace("action=edit","action=reset_lock");a.post(b,{action:"wp_pro_quiz_reset_lock"},function(){a("#resetLockMsg").show("fast").delay(2E3).hide("fast")})}},g=function(b){b=a.trim(b);return!b||0===b.length};a("#statistics_on").change(function(){this.checked?a("#statistics_ip_lock_tr").show():a("#statistics_ip_lock_tr").hide()});a(".addResult").click(function(){b.addResult()});a(".deleteResult").click(function(){b.deleteResult(this)});
a('input[name="resultTextGrade[prozent][]"]').keyup(function(){b.changeResult(this)}).keydown(function(a){13==a.which&&a.preventDefault()});a("#wpProQuiz_resultGradeEnabled").change(function(){this.checked?(a("#resultGrade").show(),a("#resultNormal").hide()):(a("#resultGrade").hide(),a("#resultNormal").show())});a("#wpProQuiz_save").click(function(d){b.validInput()||d.preventDefault();a('select[name="prerequisiteList[]"] option').attr("selected","selected")});a('input[name="quizRunOnce"]').change(function(){this.checked?
(a("#wpProQuiz_quiz_run_once_type").show(),a('input[name="quizRunOnceType"]:checked').change()):a("#wpProQuiz_quiz_run_once_type").hide()});a('input[name="quizRunOnceType"]').change(function(){this.checked&&("1"==this.value||"3"==this.value)?a("#wpProQuiz_quiz_run_once_cookie").show():a("#wpProQuiz_quiz_run_once_cookie").hide()});a('input[name="resetQuizLock"]').click(function(){b.resetLock();return!1});a(".wpProQuiz_demoBox a").mouseover(function(b){var e=a(this),f=a(document).width(),e=e.siblings().outerWidth(!0);
b.pageX+e>f&&(b=f-(b.pageX+e+30),a(this).next().css("left",b+"px"));a(this).next().show()}).mouseout(function(){a(this).next().hide()}).click(function(){return!1});a('input[name="showMaxQuestion"]').change(function(){this.checked?(a('input[name="statisticsOn"]').removeAttr("checked").attr("disabled","disabled").change(),a("#wpProQuiz_showMaxBox").show()):(a('input[name="statisticsOn"]').removeAttr("disabled"),a("#wpProQuiz_showMaxBox").hide())});a("#btnPrerequisiteAdd").click(function(){a('select[name="quizList"] option:selected').removeAttr("selected").appendTo('select[name="prerequisiteList[]"]')});
a("#btnPrerequisiteDelete").click(function(){a('select[name="prerequisiteList[]"] option:selected').removeAttr("selected").appendTo('select[name="quizList"]')});a('input[name="prerequisite"]').change(function(){this.checked?a("#prerequisiteBox").show():a("#prerequisiteBox").hide()}).change();a('input[name="toplistDataAddMultiple"]').change(function(){this.checked?a("#toplistDataAddBlockBox").show():a("#toplistDataAddBlockBox").hide()}).change();a('input[name="toplistActivated"]').change(function(){this.checked?
a("#toplistBox > tr:gt(0)").show():a("#toplistBox > tr:gt(0)").hide()}).change();a('input[name="showReviewQuestion"]').change(function(){this.checked?a(".wpProQuiz_reviewQuestionOptions").show():a(".wpProQuiz_reviewQuestionOptions").hide()}).change();a("#statistics_on").change();a("#wpProQuiz_resultGradeEnabled").change();a('input[name="quizRunOnce"]').change();a('input[name="quizRunOnceType"]:checked').change();a('input[name="showMaxQuestion"]').change()};a.fn.wpProQuiz_statistics=function(){var b=
"wpProQuiz_typeAnonymeUser",g=!0,d={loadStatistics:function(b){var f=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",b={action:"wp_pro_quiz_load_statistics",userId:b};a("#wpProQuiz_loadData").show();a("#wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a.post(f,b,d.setStatistics,"json")},setStatistics:function(e){var d=a(".wpProQuiz_statistics_table"),c=d.find("tbody");if("wpProQuiz_typeOverview"!=b){var i=function(a,
b,c){a.find(".wpProQuiz_cCorrect").text(b.cCorrect+" ("+b.pCorrect+"%)");a.find(".wpProQuiz_cIncorrect").text(b.cIncorrect+" ("+b.pIncorrect+"%)");a.find(".wpProQuiz_cTip").text(b.cTip);a.find(".wpProQuiz_cPoints").text(b.cPoints);!0==c&&d.find(".wpProQuiz_cResult").text(b.result+"%")};i(d,e.clear,!1);a.each(e.items,function(a,b){i(c.find("#wpProQuiz_tr_"+b.id),b,!1)});i(d.find("tfoot"),e.global,!0);a("#wpProQuiz_loadData").hide();a("#wpProQuiz_statistics_content, .wpProQuiz_statistics_table").show()}},
loadOverview:function(){a(".wpProQuiz_statistics_table, #wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a("#wpProQuiz_loadData").show();var e=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",f={action:"wp_pro_quiz_load_statistics",overview:!0,pageLimit:a("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(a("#wpProQuiz_onlyCompleted").is(":checked")),page:a("#wpProQuiz_currentPage").val(),generatePageNav:Number(g)};
a.post(e,f,function(c){a("#wpProQuiz_statistics_overview_data").empty();if("wpProQuiz_typeOverview"==b){var e=a('<tr><th><a href="#">---</a></th><th class="wpProQuiz_points">---</th><th class="wpProQuiz_cCorrect" style="color: green;">---</th><th class="wpProQuiz_cIncorrect" style="color: red;">---</th><th class="wpProQuiz_cTip">---</th><th class="wpProQuiz_cResult" style="font-weight: bold;">---</th></tr>');a.each(c.items,function(b,c){var d=e.clone();d.find("a").text(c.userName).data("userId",c.userId).click(function(){a("#userSelect").val(a(this).data("userId"));
a("#wpProQuiz_typeRegisteredUser").click();return!1});c.completed?(d.find(".wpProQuiz_points").text(c.cPoints),d.find(".wpProQuiz_cCorrect").text(c.cCorrect+" ("+c.pCorrect+"%)"),d.find(".wpProQuiz_cIncorrect").text(c.cIncorrect+" ("+c.pIncorrect+"%)"),d.find(".wpProQuiz_cTip").text(c.cTip),d.find(".wpProQuiz_cResult").text(c.result+"%")):d.find("th").removeAttr("style");a("#wpProQuiz_statistics_overview_data").append(d)});void 0!=c.page&&(d.setPageNav(c.page),g=!1);a("#wpProQuiz_loadData").hide();
a("#wpProQuiz_statistics_overview").show()}},"json")},changeTab:function(e){b=e;"wpProQuiz_typeRegisteredUser"==e?d.loadStatistics(a("#userSelect").val()):"wpProQuiz_typeAnonymeUser"==e?d.loadStatistics(0):d.loadOverview()},resetStatistic:function(e){var f="wpProQuiz_typeRegisteredUser"==b?a("#userSelect").val():0,c=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=reset";a.post(c,{action:"wp_pro_quiz_statistics",userId:f,complete:e},function(){d.changeTab(b)})},
setPageNav:function(b){b=Math.ceil(b/a("#wpProQuiz_pageLimit").val());a("#wpProQuiz_currentPage").empty();for(var d=1;d<=b;d++)a(document.createElement("option")).val(d).text(d).appendTo(a("#wpProQuiz_currentPage"));a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1<a("#wpProQuiz_currentPage option").length&&a("#wpProQuiz_pageRight").show()}};a(".wpProQuiz_tab").click(function(){var b=a(this);if(b.hasClass("button-primary"))return!1;"wpProQuiz_typeRegisteredUser"==b.attr("id")?a("#wpProQuiz_userBox").show():
a("#wpProQuiz_userBox").hide();a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");b.removeClass("button-secondary").addClass("button-primary");d.changeTab(b.attr("id"));return!1});a("#userSelect").change(function(){d.changeTab("wpProQuiz_typeRegisteredUser")});a(".wpProQuiz_update").click(function(){d.changeTab(b);return!1});a("#wpProQuiz_reset").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&d.resetStatistic(!1);return!1});a(".wpProQuiz_resetComplete").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&
d.resetStatistic(!0);return!1});a("#wpProQuiz_pageLimit, #wpProQuiz_onlyCompleted").change(function(){a("#wpProQuiz_currentPage").val(0);g=!0;d.changeTab(b);return!1});a("#wpProQuiz_currentPage").change(function(){a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1!=a("#wpProQuiz_currentPage option").length&&(a("#wpProQuiz_currentPage option:first-child:selected").length?a("#wpProQuiz_pageRight").show():a("#wpProQuiz_currentPage option:last-child:selected").length?a("#wpProQuiz_pageLeft").show():
a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").show());d.changeTab(b)});a("#wpProQuiz_pageRight").click(function(){a("#wpProQuiz_currentPage option:selected").next().attr("selected","selected");a("#wpProQuiz_currentPage").change();return!1});a("#wpProQuiz_pageLeft").click(function(){a("#wpProQuiz_currentPage option:selected").prev().attr("selected","selected");a("#wpProQuiz_currentPage").change();return!1});d.changeTab("wpProQuiz_typeAnonymeUser")};a.fn.wpProQuiz_toplist=function(){var b=this,g=a("#wpProQuiz_sorting"),
d=a("#wpProQuiz_pageLimit"),e=a("#wpProQuiz_currentPage"),f=a("#wpProQuiz_loadData"),c=a("#wpProQuiz_pageLeft"),i=a("#wpProQuiz_pageRight"),l=a("#wpProQuiz_toplistTable tbody"),j=a("#wpProQuiz_toplistTable tbody tr:eq(0)").clone(),m=a("#wpProQuiz_content"),b={loadData:function(c){var h=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_toplist",n={action:"wp_pro_quiz_load_toplist",sort:g.val(),limit:d.val(),page:e.val()};void 0!=c&&a.extend(n,c);
f.show();m.hide();a.post(h,n,function(a){b.handleDataRequest(a.data);void 0!=a.nav&&b.handleNav(a.nav);f.hide();m.show()},"json")},handleNav:function(c){e.empty();for(var h=1;h<=c.pages;h++)a(document.createElement("option")).val(h).text(h).appendTo(e);b.checkNav()},handleDataRequest:function(b){l.empty();a.each(b,function(a,b){var c=j.clone().children();c.eq(0).children().val(b.id);c.eq(1).text(b.name);c.eq(2).text(b.email);c.eq(3).text(b.type);c.eq(4).text(b.date);c.eq(5).text(b.points);c.eq(6).text(b.result);
c.parent().show().appendTo(l)});b.length||a(document.createElement("td")).attr("colspan","7").text(wpProQuizLocalize.no_data_available).css({"font-weight":"bold","text-align":"center",padding:"5px"}).appendTo(document.createElement("tr")).appendTo(l)},checkNav:function(){var a=e.val();1==a?c.hide():c.show();a==e.children().length?i.hide():i.show()}};g.change(function(){b.loadData()});d.change(function(){b.loadData({nav:1})});e.change(function(){b.checkNav();b.loadData()});c.click(function(){e.val(Number(e.val())-
1);b.checkNav();b.loadData()});i.click(function(){e.val(Number(e.val())+1);b.checkNav();b.loadData()});a("#wpProQuiz_deleteAll").click(function(){b.loadData({a:"deleteAll"})});a("#wpProQuiz_action").click(function(){var c=a("#wpProQuiz_actionName").val();if("0"!=c){var h=a('input[name="checkedData[]"]:checked').map(function(){return a(this).val()}).get();b.loadData({a:c,toplistIds:h})}});a("#wpProQuiz_checkedAll").change(function(){this.checked?a('input[name="checkedData[]"]').attr("checked","checked"):
a('input[name="checkedData[]"]').removeAttr("checked","checked")});b.loadData({nav:1})};a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_preview();a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_quizOverall();a(".wpProQuiz_quizEdit").length&&a(".wpProQuiz_quizEdit").wpProQuiz_quizEdit();a(".wpProQuiz_questionOverall").length&&a(".wpProQuiz_questionOverall").wpProQuiz_questionOverall();a(".wpProQuiz_toplist").length&&a(".wpProQuiz_toplist").wpProQuiz_toplist();
(function(){var b=this,b={displayChecked:function(a,b,d,e){a=d?!a.checked:a.checked;e?a?b.attr("disabled","disabled"):b.removeAttr("disabled"):a?b.show():b.hide()},isEmpty:function(b){b=a.trim(b);return!b||0===b.length},isNumber:function(c){c=a.trim(c);return!b.isEmpty(c)&&!isNaN(c)},getMceContent:function(b){var d=tinymce.editors[b];return void 0!=d&&!d.isHidden()?d.getContent():a("#"+b).val()},ajaxPost:function(b,d,e){a.post(ajaxurl,{action:"wp_pro_quiz_admin_ajax",func:b,data:d},e,"json")}},g=
function(){var c={categoryDelete:function(c){b.ajaxPost("categoryDelete",{categoryId:c},function(b){b.err||(a('select[name="category"] option[value="'+c+'"]').remove(),a('select[name="category"]').change())})},categoryEdit:function(c,d){var e={categoryId:c,categoryName:a.trim(d)};b.isEmpty(d)?alert(wpProQuizLocalize.category_no_name):b.ajaxPost("categoryEdit",e,function(b){b.err||(a('select[name="category"] option[value="'+c+'"]').text(e.categoryName),a('select[name="category"]').change())})}};a(".wpProQuiz_tab").click(function(){var b=
a(this);a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");b.removeClass("button-secondary").addClass("button-primary");a("#problemInfo, #problemContent, #globalContent").hide("fast");"globalTab"==b.attr("id")?a("#globalContent").show("fast"):a("#problemInfo, #problemContent").show("fast")});a('select[name="category"]').change(function(){a('input[name="categoryEditText"]').val(a(this).find(":selected").text())}).change();a('input[name="categoryDelete"]').click(function(){var b=
a('select[name="category"] option:selected').val();c.categoryDelete(b)});a('input[name="categoryEdit"]').click(function(){var b=a('select[name="category"] option:selected').val(),d=a('input[name="categoryEditText"]').val();c.categoryEdit(b,d)})},d=function(){var c=this,d=a.noop(),e=a(".answer_felder > div"),f=a('input[name="answerPointsActivated"]'),g=a('input[name="points"]'),c={generateArrayIndex:function(){var b=a('input[name="answerType"]:checked').val(),b="single"==b||"multiple"==b?"classic_answer":
b;a(".answerList").each(function(){var c=a(this).parent().attr("class");a(this).children().each(function(d){a(this).find('[name^="answerData"]').each(function(){var a=this.name,e=a.search(/\](\[\w+\])+$/),f=b==c?d:"none";0<e&&(this.name="answerData["+f+a.substring(e,a.length))})})})},globalValidate:function(){if(b.isEmpty(b.getMceContent("question")))return alert(wpProQuizLocalize.no_question_msg),!1;if(f.is(":checked")){if("free_answer"==a('input[name="answerType"]:checked').val())return alert(wpProQuizLocalize.dif_points),
!1}else{var c=g.val();if(!b.isNumber(c)||1>c)return alert(wpProQuizLocalize.no_nummber_points),!1}return!1===d()?!1:!0},answerRemove:function(){var b=a(this).parent();if(2>b.parent().children().length)return!1;b.remove();return!1},addCategory:function(){var c=a.trim(a('input[name="categoryAdd"]').val());b.isEmpty(c)||b.ajaxPost("categoryAdd",{categoryName:c},function(b){b.err?a("#categoryMsgBox").text(b.err).show("fast").delay(2E3).hide("fast"):(b=a(document.createElement("option")).val(b.categoryId).text(b.categoryName).attr("selected",
"selected"),a('select[name="category"]').append(b).change())})}},k={classic_answer:function(){var c=0,d=0,e=0;a(".classic_answer .answerList").children().each(function(){var f=a(this);b.isEmpty(f.find('textarea[name="answerData[][answer]"]').val())||(c++,f.find('input[name="answerData[][correct]"]:checked').length&&d++,f=f.find('input[name="answerData[][points]"]').val(),b.isNumber(f)&&0<=f&&e++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):!d?(alert(wpProQuizLocalize.no_correct_msg),!1):
e!=c&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0},free_answer:function(){return b.isEmpty(a('.free_answer textarea[name="answerData[][answer]"]').val())?(alert(wpProQuizLocalize.no_answer_msg),!1):!0},cloze_answer:function(){return b.isEmpty(b.getMceContent("cloze"))?(alert(wpProQuizLocalize.no_answer_msg),!1):!0},sort_answer:function(){var c=0,d=0;a(".sort_answer .answerList").children().each(function(){var e=a(this);b.isEmpty(e.find('textarea[name="answerData[][answer]"]').val())||
(c++,e=e.find('input[name="answerData[][points]"]').val(),b.isNumber(e)&&0<=e&&d++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):d!=c&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0},matrix_sort_answer:function(){var c=0,d=0,e=!0,g=0;a(".matrix_sort_answer .answerList").children().each(function(){var f=a(this),j=f.find('input[name="answerData[][points]"]').val();b.isEmpty(f.find('textarea[name="answerData[][answer]"]').val())?b.isEmpty(f.find('textarea[name="answerData[][sort_string]"]').val())||
(g++,b.isNumber(j)&&0<=j&&d++):(c++,g++,b.isEmpty(f.find('textarea[name="answerData[][sort_string]"]').val())&&(e=!1),b.isNumber(j)&&0<=j&&d++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):!e?(alert(wpProQuizLocalize.no_sort_element_criterion),!1):d!=g&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0}};e.hide();a("#wpProQuiz_tip").change(function(){b.displayChecked(this,a("#wpProQuiz_tipBox"))}).change();a("#wpProQuiz_correctSameText").change(function(){b.displayChecked(this,
a("#wpProQuiz_incorrectMassageBox"),!0)}).change();a('input[name="answerType"]').click(function(){e.hide();var b=this.value;if("single"==b||"multiple"==b){var c="single"==b?"radio":"checkbox",b="classic_answer";a(".wpProQuiz_classCorrect").each(function(){a("<input type="+c+" />").attr({name:this.name,value:this.value,checked:this.checked}).addClass("wpProQuiz_classCorrect wpProQuiz_checkbox").insertBefore(this)}).remove()}d=void 0!=k[b]?k[b]:a.noop();a("."+b).show()});a('input[name="answerType"]:checked').click();
a(".deleteAnswer").click(c.answerRemove);a(".addAnswer").click(function(){var b=a(this).siblings("ul"),d=b.find("li:eq(0)").clone();d.find(".wpProQuiz_checkbox").removeAttr("checked");d.find(".wpProQuiz_text").val("");d.find(".wpProQuiz_points").val(1);d.find(".deleteAnswer").click(c.answerRemove);d.appendTo(b);return!1});a(".sort_answer ul, .classic_answer ul, .matrix_sort_answer ul").sortable({handle:".wpProQuiz_move"});a("#saveQuestion").click(function(){if(!c.globalValidate())return!1;c.generateArrayIndex();
return!0});a(f).change(function(){b.displayChecked(this,a(".wpProQuiz_answerPoints"));b.displayChecked(this,a("#wpProQuiz_showPointsBox"));b.displayChecked(this,g,!1,!0)}).change();a('select[name="category"]').change(function(){var b=a(this),c=a("#categoryAddBox").hide();"-1"==b.val()&&c.show()}).change();a("#categoryAddBtn").click(function(){c.addCategory()})},e=function(){var c=this,d=a("#quizId").val(),e="users",f=a("#wpProQuiz_currentPage"),g=a("#wpProQuiz_pageLeft"),k=a("#wpProQuiz_pageRight"),
c={loadStatistic:function(a){b.ajaxPost("statisticLoad",{userId:a},function(){})},loadUsersStatistic:function(){var e={userId:a("#userSelect").val(),quizId:d};c.toggleLoadBox(!1);b.ajaxPost("statisticLoad",e,function(b){a.each(b.question,function(){var b=a("#wpProQuiz_tr_"+this.questionId);c.setStatisticData(b,this)});a.each(b.category,function(b,d){var e=a("#wpProQuiz_ctr_"+b);c.setStatisticData(e,d)});c.toggleLoadBox(!0)})},setStatisticData:function(a,b){a.find(".wpProQuiz_cCorrect").text(b.correct);
a.find(".wpProQuiz_cIncorrect").text(b.incorrect);a.find(".wpProQuiz_cTip").text(b.hint);a.find(".wpProQuiz_cPoints").text(b.points);a.find(".wpProQuiz_cResult").text(b.result)},toggleLoadBox:function(b){var c=a("#wpProQuiz_loadData"),d=a("#wpProQuiz_content");b?(c.hide(),d.show()):(d.hide(),c.show())},reset:function(e){var f=a("#userSelect").val();confirm(wpProQuizLocalize.reset_statistics_msg)&&(e={quizId:d,userId:f,full:e?1:0},c.toggleLoadBox(!1),b.ajaxPost("statisticReset",e,function(){c.loadUsersStatistic()}))},
loadStatisticOverview:function(e){e={quizId:d,pageLimit:a("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(a("#wpProQuiz_onlyCompleted").is(":checked")),page:f.val(),nav:Number(e)};c.toggleLoadBox(!1);b.ajaxPost("statisticLoadOverview",e,function(b){var d=a("#wpProQuiz_statistics_overview_data"),e=d.children(),f=e.first().clone();e.slice(1).remove();a.each(b.items,function(){var b=f.clone();c.setStatisticData(b,this);b.find("a").text(this.userName).data("userId",this.userId).click(function(){a("#userSelect").val(a(this).data("userId"));
a("#wpProQuiz_typeUser").click();return!1});b.show().appendTo(d)});f.remove();c.toggleLoadBox(!0);void 0!=b.page&&c.handleNav(b.page)})},handleNav:function(b){for(var d=a("#wpProQuiz_currentPage").empty(),e=1;e<=b;e++)a(document.createElement("option")).val(e).text(e).appendTo(d);c.checkNavBar()},checkNavBar:function(){var a=f.val();1==a?g.hide():g.show();a==f.children().length?k.hide():k.show()},refresh:function(){"users"==e?c.loadUsersStatistic():c.loadStatisticOverview(!0)}};a("#userSelect").change(function(){c.loadUsersStatistic()});
a(".wpProQuiz_update").click(function(){c.refresh()});a("#wpProQuiz_reset").click(function(){c.reset(!1)});a(".wpProQuiz_resetComplete").click(function(){c.reset(!0)});a(".wpProQuiz_tab").click(function(){var b=a(this);a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");b.removeClass("button-secondary").addClass("button-primary");a(".wpProQuiz_tabContent").hide();"wpProQuiz_typeUser"==b.attr("id")?(e="users",a("#wpProQuiz_tabUsers").show(),c.loadUsersStatistic()):(e="overview",
a("#wpProQuiz_tabOverview").show(),c.loadStatisticOverview(!0));return!1});a("#wpProQuiz_onlyCompleted").change(function(){f.val(1);c.loadStatisticOverview(!0)});a("#wpProQuiz_pageLimit").change(function(){f.val(1);c.loadStatisticOverview(!0)});g.click(function(){f.val(Number(f.val())-1);c.loadStatisticOverview(!1);c.checkNavBar()});k.click(function(){f.val(Number(f.val())+1);c.loadStatisticOverview(!1);c.checkNavBar()});f.change(function(){c.loadStatisticOverview(!1);c.checkNavBar()});c.loadUsersStatistic()},
f=a.noop;a(".wpProQuiz_questionEdit").length?f=d:a(".wpProQuiz_globalSettings").length?f=g:a(".wpProQuiz_statistics").length&&(f=e);f()})()});
