(function(e){e.wpProQuizFront=function(C,f){var b=e(C),d=this,j={},K=0,g=null,t=[],L=0,M=0,u=0,N=0,v=0,D=0,E=0,O=0,P=0,w=0,Q=0,R=0,F=0,S=0,W=b.find('input[name="back"]'),T=b.find('input[name="next"]'),l=b.find(".wpProQuiz_quiz"),q=b.find(".wpProQuiz_list"),x=b.find(".wpProQuiz_results"),y=b.find(".wpProQuiz_text"),z=b.find(".wpProQuiz_time_limit"),G=b.find(".wpProQuiz_toplistShowInButton"),U="",H=0,A=f.timelimit,V=0,I={stop:function(){A&&(window.clearInterval(V),z.hide())},start:function(){if(A){var a=
1E3*A,c=z.find("span").text(d.methode.parseTime(A)),b=z.find(".wpProQuiz_progress");z.show();var e=+new Date;V=window.setInterval(function(){var i=+new Date-e,h=a-i;500<=i&&c.text(d.methode.parseTime(Math.ceil(h/1E3)));b.css("width",100*(h/a)+"%");0>=h&&(I.stop(),d.methode.finishQuiz(!0))},16)}}},s=new function(){function a(a){var c="",b=r[a];b.review?c="#FFB800":b.solved&&(c="#6CA54C");f.eq(a).css("background-color",c)}function c(a){a.preventDefault();a=a.pageY-j;0>a&&(a=0);a>g&&(a=g);h.attr("style",
"margin-top: "+-(B*a)+"px !important");i.css({top:a})}function n(a){a.preventDefault();e(document).unbind(".scrollEvent")}var k=[],i=[],h=[],f=[],g=0,j=0,B=0,J=0,p=0,r=[];this.init=function(){k=b.find(".wpProQuiz_reviewQuestion");i=k.find("div");h=k.find("ol");f=h.children();i.mousedown(function(a){a.preventDefault();a.stopPropagation();j=a.pageY-i.offset().top+J;e(document).bind("mouseup.scrollEvent",n);e(document).bind("mousemove.scrollEvent",c)});f.click(function(){d.methode.showQuestion(e(this).index())});
b.bind("questionSolved",function(c){r[c.values.index].solved=c.values.solved;a(c.values.index)});b.bind("changeQuestion",function(a){f.removeClass("wpProQuiz_reviewQuestionTarget");f.eq(a.values.index).addClass("wpProQuiz_reviewQuestionTarget");var a=f.eq(a.values.index),c=a.offset().top,b=k.offset().top,c=c-b;if(0>c-4||100<c+32)a=b-f.eq(0).offset().top-(b-h.offset().top)+a.position().top,a>p&&(a=p),b=a/B,h.attr("style","margin-top: "+-a+"px !important"),i.css({top:b})});b.bind("reviewQuestion",function(c){r[c.values.index].review=
!r[c.values.index].review;a(c.values.index)});k.bind("mousewheel DOMMouseScroll",function(a){a.preventDefault();a=a.originalEvent;a=20*(a.wheelDelta?-a.wheelDelta/120:a.detail/3);a=J-h.offset().top+a;a>p&&(a=p);0>a&&(a=0);var c=a/B;h.attr("style","margin-top: "+-a+"px !important");i.css({top:c});return!1})};this.show=function(a){w&&k.parent().show();if(!a){var a=h.outerHeight(),c=k.height();g=c-i.height();j=0;p=a-c;B=p/g;this.reset();100<a&&i.show();J=i.offset().top}};this.hide=function(){k.parent().hide()};
this.reset=function(){for(var a=0,c=f.length;a<c;a++)r[a]={};f.removeClass("wpProQuiz_reviewQuestionTarget").css("background-color","")}};d.methode={parseBitOptions:function(){if(f.bo){L=f.bo&1;M=f.bo&2;u=f.bo&4;N=f.bo&8;v=f.bo&16;E=f.bo&64;w=f.bo&128;O=f.bo&256;P=f.bo&512;var a=f.bo&32;a&&(void 0!=jQuery.support&&void 0!=jQuery.support.cors&&!1==jQuery.support.cors)&&(D=a)}},setClozeStyle:function(){b.find(".wpProQuiz_cloze input").each(function(){for(var a=e(this),c="",b=a.data("wordlen"),d=0;d<
b;d++)c+="w";c=e(document.createElement("span")).css("visibility","hidden").text(c).appendTo(e("body"));b=c.width();c.remove();a.width(b+5)})},parseTime:function(a){var c=parseInt(a%60),b=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<b?"":"0")+b)+":"+((9<c?"":"0")+c)},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');a=a.replace(/\u201D/,'"');return e.trim(a).toLowerCase()},resetMatrix:function(a){a.each(function(){var a=
e(this),b=a.find(".wpProQuiz_sortStringList");a.find(".wpProQuiz_sortStringItem").each(function(){b.append(e(this))})})},marker:function(a,c){u||(c?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(){if(F)Q=1;else if(R)y.hide(),b.find(".wpProQuiz_lock").show();else if(S)y.hide(),b.find(".wpProQuiz_prerequisite").show();else{d.methode.loadQuizData();M&&d.methode.random(q);L&&d.methode.random(b.find(".wpProQuiz_questionList"));d.methode.random(b.find(".wpProQuiz_sortStringList"));
d.methode.random(b.find('[data-type="sort_answer"]'));b.find(".wpProQuiz_listItem").each(function(a){var b=e(this);b.find(".wpProQuiz_question_page span:eq(0)").text(a+1);b.find("> h5 span").text(a+1);b.find(".wpProQuiz_questionListItem").each(function(a){e(this).find("> span:not(.wpProQuiz_cloze)").text(a+1+". ")})});switch(f.mode){case 3:b.find('input[name="checkSingle"]').show();b.find(".wpProQuiz_question_page").hide();break;case 2:b.find('input[name="check"]').show();!P&&w&&b.find('input[name="skip"]').show();
break;case 1:b.find('input[name="back"]').slice(1).show();case 0:T.show()}var a=q.children();3==f.mode?a.show():(g=a.eq(0).show(),b.trigger({type:"changeQuestion",values:{item:g,index:g.index()}}));b.find(".wpProQuiz_sortable").parents("ul").sortable({update:function(){var a=e(this).parents(".wpProQuiz_listItem");b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:!0}})}}).disableSelection();b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",
placeholder:"wpProQuiz_placehold",update:function(){var a=e(this).parents(".wpProQuiz_listItem");b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:!0}})}}).disableSelection();t=[];I.start();K=+new Date;j={comp:{points:0,correctQuestions:0}};y.hide();l.show();s.show()}},nextQuestion:function(){g=g.hide().next().show();d.methode.scrollTo(l);b.trigger({type:"changeQuestion",values:{item:g,index:g.index()}});g.length||d.methode.showQuizSummary()},prevQuestion:function(){g=g.hide().prev().show();
d.methode.scrollTo(l);b.trigger({type:"changeQuestion",values:{item:g,index:g.index()}})},showQuestion:function(a){3==f.mode?d.methode.scrollTo(b.find(".wpProQuiz_list > li").eq(a),1):(g.hide(),g=b.find(".wpProQuiz_list > li").eq(a).show(),d.methode.scrollTo(l),b.trigger({type:"changeQuestion",values:{item:g,index:g.index()}}),g.length||d.methode.showQuizSummary())},skipQuestion:function(){b.trigger({type:"skipQuestion",values:{item:g,index:g.index()}});d.methode.nextQuestion()},reviewQuestion:function(){b.trigger({type:"reviewQuestion",
values:{item:g,index:g.index()}})},showQuizSummary:function(){if(O||!w)d.methode.finishQuiz();else{var a=b.find(".wpProQuiz_checkPage");a.find("ol:eq(0)").empty().append(b.find(".wpProQuiz_reviewQuestion ol li").clone().removeClass("wpProQuiz_reviewQuestionTarget")).children().click(function(){a.hide();l.show();s.show(!0);d.methode.showQuestion(e(this).index())});for(var c=0,n=0,f=t.length;n<f;n++)t[n]&&c++;a.find("span:eq(0)").text(c);s.hide();l.hide();a.show();d.methode.scrollTo(a)}},finishQuiz:function(a){I.stop();
var c=(+new Date-K)/1E3,c=f.timelimit&&c>f.timelimit?f.timelimit:c;b.find(".wpProQuiz_quiz_time span").text(d.methode.parseTime(c));a&&x.find(".wpProQuiz_time_limit_expired").show();d.methode.checkQuestion(q.children());b.find(".wpProQuiz_correct_answer").text(j.comp.correctQuestions);j.comp.result=Math.round(1E4*(j.comp.points/f.globalPoints))/100;$pointFields=b.find(".wpProQuiz_points span");$pointFields.eq(0).text(j.comp.points);$pointFields.eq(1).text(f.globalPoints);$pointFields.eq(2).text(j.comp.result+
"%");b.find(".wpProQuiz_resultsList > li").eq(d.methode.findResultIndex(j.comp.result)).show();d.methode.setAverageResult(j.comp.result,!1);d.methode.sendCompletedQuiz();E&&H&&d.methode.addToplist();s.hide();b.find(".wpProQuiz_checkPage").hide();l.hide();x.show();d.methode.scrollTo(x)},questionSolved:function(a){t[a.values.index]=a.values.solved},sendCompletedQuiz:function(){v||d.methode.ajax({action:"wp_pro_quiz_completed_quiz",quizId:f.quizId,results:j})},findResultIndex:function(a){for(var b=f.resultsGrade,
d=-1,e=999999,i=0;i<b.length;i++){var h=b[i];a>=h&&a-h<e&&(e=a-h,d=i)}return d},showQustionList:function(){G.hide();l.toggle();b.find(".wpProQuiz_QuestionButton").hide();q.children().show();b.find(".wpProQuiz_question_page").hide()},random:function(a){a.each(function(){var a=e(this).children().get().sort(function(){return Math.round(Math.random())-0.5});e(a).appendTo(a[0].parentNode)})},restartQuiz:function(){x.hide();y.show();q.children().hide();G.hide();b.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").val("").css("background-color",
"");b.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect");b.find(".wpProQuiz_listItem").data("check",!1);b.find(".wpProQuiz_response").hide().children().hide();d.methode.resetMatrix(b.find(".wpProQuiz_listItem"));b.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style");b.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide();b.find('.wpProQuiz_question_page, input[name="tip"]').show()},
checkQuestion:function(a){a=void 0==a?g:a;a.each(function(){var a,n,k=e(this),i=k.find(".wpProQuiz_questionList"),h=f.json[i.data("question_id")];a=h.type;if(k.data("check"))return!0;if("single"==h.type||"multiple"==h.type)a="singleMulti";var g=!0,m=0,l=e.isArray(h.points);({singleMulti:function(){var a=i.find(".wpProQuiz_questionInput").attr("disabled","disabled");i.children().each(function(b){var c=e(this),f=c.data("pos"),b=a.eq(b).is(":checked");h.correct[f]?(d.methode.marker(c,!0),b?l&&(m+=h.points[f]):
g=!1):b?(d.methode.marker(c,!1),g=!1):l&&(m+=h.points[f])})},sort_answer:function(){var a=i.children();a.each(function(a){var b=e(this);a==b.data("pos")?(d.methode.marker(b,!0),l&&(m+=h.points[a])):(d.methode.marker(b,!1),g=!1)});a.children().css({"box-shadow":"0 0",cursor:"auto"});i.sortable("destroy");a.sort(function(a,b){return e(a).data("pos")>e(b).data("pos")?1:-1});i.append(a)},matrix_sort_answer:function(){var a=[];i.children().each(function(){var b=e(this),c=b.data("pos"),b=b.find(".wpProQuiz_maxtrixSortCriterion"),
f=b.children();c==f.data("pos")?(d.methode.marker(b,!0),l&&(m+=h.points[c])):(g=!1,d.methode.marker(b,!1));a[c]=b});d.methode.resetMatrix(k);k.find(".wpProQuiz_sortStringItem").each(function(){var b=a[e(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"});k.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var a=i.children(),b=a.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();0<=e.inArray(e.trim(b).toLowerCase(),
h.correct)?d.methode.marker(a,!0):(d.methode.marker(a,!1),g=!1)},cloze_answer:function(){i.find(".wpProQuiz_cloze").each(function(a){var b=e(this).children(),c=b.eq(0),b=b.eq(1),f=d.methode.cleanupCurlyQuotes(c.val());0<=e.inArray(f,h.correct[a])?(l&&(m+=h.points[a]),u||c.css("background-color","#B0DAB0")):(u||c.css("background-color","#FFBABA"),g=!1,b.show());c.attr("disabled","disabled")})}})[a]();!l&&g&&(m=h.points);a=g;n=m;k.find(".wpProQuiz_response").show();k.find('input[name="check"]').hide();
k.find('input[name="skip"]').hide();k.find('input[name="next"]').show();void 0==j[h.id]&&(j[h.id]={});j[h.id].points=n;j[h.id].correct=Number(a);j.comp.points+=n;a?(k.find(".wpProQuiz_correct").show(),j.comp.correctQuestions+=1):k.find(".wpProQuiz_incorrect").show();k.find(".wpProQuiz_responsePoints").text(n);k.data("check",!0);b.trigger({type:"questionSolved",values:{item:k,index:k.index(),solved:!0}})})},showTip:function(){var a=e(this),c=a.siblings(".wpProQuiz_question").find(".wpProQuiz_questionList").data("question_id");
a.siblings(".wpProQuiz_tipp").toggle("fast");void 0==j[c]&&(j[c]={});j[c].tip=1;e(document).bind("mouseup.tipEvent",function(a){var c=b.find(".wpProQuiz_tipp"),d=b.find('input[name="tip"]');!c.is(a.target)&&(0==c.has(a.target).length&&!d.is(a.target))&&(c.hide("fast"),e(document).unbind(".tipEvent"))})},ajax:function(a,b,d){D&&(jQuery.support.cors=!0);e.post(WpProQuizGlobal.ajaxurl,a,b,d||"json");D&&(jQuery.support.cors=!1)},checkQuizLock:function(){F=1;d.methode.ajax({action:"wp_pro_quiz_check_lock",
quizId:f.quizId},function(a){void 0!=a.lock&&(R=a.lock.is,a.lock.pre&&b.find('input[name="restartQuiz"]').hide());void 0!=a.prerequisite&&(S=1,b.find(".wpProQuiz_prerequisite span").text(a.prerequisite));F=0;Q&&d.methode.startQuiz()})},loadQuizData:function(){d.methode.ajax({action:"wp_pro_quiz_load_quiz_data",quizId:f.quizId},function(a){a.toplist&&d.methode.handleToplistData(a.toplist);void 0!=a.averageResult&&d.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,c){var d=
b.find(".wpProQuiz_resultValue:eq("+(c?0:1)+") > * ");d.eq(1).text(a+"%");d.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var c=b.find(".wpProQuiz_addToplist"),d=c.find(".wpProQuiz_addBox").show().children("div");a.canAdd?(c.show(),c.find(".wpProQuiz_addToplistMessage").hide(),c.find(".wpProQuiz_toplistButton").show(),U=a.token,H=0,a.userId?(d.hide(),H=1,E&&c.hide()):(d.show(),c=d.children().eq(1),a.captcha?(c.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),c.find(".wpProQuiz_captchaImg").attr("src",
a.captcha.img),c.find('input[name="wpProQuiz_captcha"]').val(""),c.show()):c.hide())):c.hide()},scrollTo:function(a,b){var d=a.offset().top-100;(b||(window.pageYOffset||document.body.scrollTop)>d)&&e("html,body").animate({scrollTop:d},300)},addToplist:function(){if(!v){var a=b.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),c=b.find(".wpProQuiz_addBox").hide();d.methode.ajax({action:"wp_pro_quiz_add_toplist",quizId:f.quizId,token:U,name:c.find('input[name="wpProQuiz_toplistName"]').val(),
email:c.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:c.find('input[name="wpProQuiz_captcha"]').val(),prefix:c.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:j.comp.points,totalPoints:f.globalPoints},function(b){a.text(b.text);b.clear?(c.hide(),d.methode.updateToplist()):c.show();b.captcha&&(c.find(".wpProQuiz_captchaImg").attr("src",b.captcha.img),c.find('input[name="wpProQuiz_captchaPrefix"]').val(b.captcha.code),c.find('input[name="wpProQuiz_captcha"]').val(""))})}},updateToplist:function(){"function"==
typeof wpProQuiz_fetchToplist&&wpProQuiz_fetchToplist()},registerSolved:function(){b.find('.wpProQuiz_questionInput[type="text"]').change(function(){var a=e(this),c=a.parents(".wpProQuiz_listItem"),d=!1;""!=a.val()&&(d=!0);b.trigger({type:"questionSolved",values:{item:c,index:c.index(),solved:d}})});b.find('.wpProQuiz_questionList[data-type="single"] .wpProQuiz_questionInput').change(function(){var a=e(this).parents(".wpProQuiz_listItem"),c=this.checked;b.trigger({type:"questionSolved",values:{item:a,
index:a.index(),solved:c}})});b.find(".wpProQuiz_cloze input").change(function(){var a=e(this).parents(".wpProQuiz_listItem"),c=!0;a.find(".wpProQuiz_cloze input").each(function(){if(""==e(this).val())return c=!1});b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:c}})});b.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').change(function(){var a=e(this).parents(".wpProQuiz_listItem"),c=0;a.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').each(function(){this.checked&&
c++});b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:c?!0:!1}})})}};d.init=function(){d.methode.parseBitOptions();d.methode.setClozeStyle();d.methode.registerSolved();s.init();N&&!v&&d.methode.checkQuizLock();b.find('input[name="startQuiz"]').click(function(){d.methode.startQuiz();return!1});T.click(function(){d.methode.nextQuestion()});W.click(function(){d.methode.prevQuestion()});b.find('input[name="reShowQuestion"]').click(function(){d.methode.showQustionList()});b.find('input[name="restartQuiz"]').click(function(){d.methode.restartQuiz()});
b.find('input[name="check"]').click(function(){d.methode.checkQuestion()});b.find('input[name="checkSingle"]').click(function(){d.methode.showQuizSummary()});b.find('input[name="tip"]').click(d.methode.showTip);b.find('input[name="skip"]').click(d.methode.skipQuestion);b.find('input[name="review"]').click(d.methode.reviewQuestion);b.find('input[name="wpProQuiz_toplistAdd"]').click(d.methode.addToplist);b.find('input[name="quizSummary"]').click(d.methode.showQuizSummary);b.find('input[name="endQuizSummary"]').click(function(){d.methode.finishQuiz()});
b.find('input[name="showToplist"]').click(function(){l.hide();G.toggle()});b.bind("questionSolved",d.methode.questionSolved)};d.init()};e.fn.wpProQuizFront=function(C){return this.each(function(){void 0==e(this).data("wpProQuizFront")&&e(this).data("wpProQuizFront",new e.wpProQuizFront(this,C))})}})(jQuery);
